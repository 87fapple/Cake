<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Display and Upload Images</title>
    <script>
      function loadImagesWithAjax(bid) {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", `./php/mainpage/previmg.php?bid=${bid}`, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
              const images = JSON.parse(xhr.responseText);
              const imgElements = document.querySelectorAll("img");

              for (let i = 0; i < images.length; i++) {
                imgElements[i].src = `data:image/jpeg;base64,${images[i]}`;
              }
            } else {
              console.error("Error:", xhr.status, xhr.statusText);
            }
          }
        };
        xhr.send();
      }

      function updateImagePreview(inputIndex) {
        const inputElement = document.getElementsByName(`file${inputIndex}`)[0];
        const imgElement = document.querySelectorAll("img")[inputIndex - 1];

        if (inputElement.files && inputElement.files[0]) {
          const reader = new FileReader();
          reader.onload = function (e) {
            imgElement.src = e.target.result;
          };
          reader.readAsDataURL(inputElement.files[0]);
        }
      }

      function submitForm() {
        const form = document.getElementById("imageForm");
        const bid = form.getAttribute("data-bid");

        const formData = new FormData(form);

        const xhr = new XMLHttpRequest();
        xhr.open("POST", `./php/mainpage/upload.php?bid=${bid}`, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
              console.log("Upload successful");
            } else {
              console.error("Error:", xhr.status, xhr.statusText);
            }
          }
        };
        xhr.send(formData);
      }
    </script>
  </head>
  <body>
    <button onclick="loadImagesWithAjax(1)">顯示圖片1</button>
    <button onclick="loadImagesWithAjax(2)">顯示圖片2</button>
    <button onclick="loadImagesWithAjax(3)">顯示圖片3</button>
    <button onclick="loadImagesWithAjax(4)">顯示圖片4</button>
    <form id="imageForm" data-bid="">
      <!-- 初始載入頁面時的表單內容 -->
      <input type="file" name="file1" onchange="updateImagePreview(1)" />
      <img src="" alt="" />
      <input type="file" name="file2" onchange="updateImagePreview(2)" />
      <img src="" alt="" />
      <input type="file" name="file3" onchange="updateImagePreview(3)" />
      <img src="" alt="" />
      <input type="file" name="file4" onchange="updateImagePreview(4)" />
      <img src="" alt="" />
      <input type="file" name="file5" onchange="updateImagePreview(5)" />
      <img src="" alt="" />
      <textarea name="body" rows="4" cols="50"></textarea>
      <button type="button" onclick="submitForm()">上傳</button>
    </form>
  </body>
</html>
